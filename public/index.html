<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShowCall ‚Äî Resolume Arena Controller</title>
  <meta name="description" content="Professional Resolume Arena 7.19 controller for live events">
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="/cuestack.css">
</head>
<body>
  <div class="page">
    <header class="top">
      <h1>ShowCall <span style="opacity: 0.5; font-weight: 400; font-size: 14px;">via OSC</span></h1>
      <div class="meta">
        <span id="comp" style="font-weight: 600;">‚Äî</span>
        <span id="bpm">BPM: ‚Äî</span>
  <span id="version" class="version-display" title="ShowCall Version">v2.4.1</span>
        <div id="updateIndicator" class="update-indicator" style="display: none;" title="Update available">
          <span class="update-icon">üì¶</span>
          <span class="update-text">Update Available</span>
        </div>
        <button id="deckWindowBtn" class="settings-btn" title="Pop-out Preset Deck">ü™ü Pop-out Deck</button>
        <button id="checkUpdateBtn" class="settings-btn" title="Check for Updates" style="display: none;">üîÑ Check Updates</button>
        <button id="settingsBtn" class="settings-btn" title="Settings">‚öôÔ∏è Settings</button>
        <button id="presetsBtn" class="settings-btn" title="Manage Presets">üéõÔ∏è Presets</button>
      </div>
    </header>

    <section class="status-bar unified-status">
      <div class="tile prog-tile" id="programTile" title="Active Program Clip">
        <div class="title program">PROGRAM</div>
        <div class="clip" id="progName">‚Äî</div>
        <div class="sub" id="progLayer">Layer ‚Äî ‚Ä¢ Col ‚Äî</div>
      </div>
      <div class="tile prev-tile" id="previewTile" title="Active Preview Clip">
        <div class="title preview">PREVIEW</div>
        <div class="clip" id="prevName">‚Äî</div>
        <div class="sub" id="prevLayer">Layer ‚Äî ‚Ä¢ Col ‚Äî</div>
      </div>
    </section>

    <section id="grid" role="grid" aria-label="Resolume clip grid"></section>

    <section class="actions">
      <h3 style="margin: 16px 0 8px; opacity: 0.9; font-size: 14px; font-weight: 600;">Quick Actions</h3>
      <div id="quickCues" class="cues" role="toolbar" aria-label="Quick action buttons"></div>
    </section>

    <section>
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">Preset Deck</h2>
      <div id="deck" class="deck" role="toolbar" aria-label="Preset buttons"></div>
      <div class="hint">üí° Use keyboard shortcuts (1, 2, B, etc.) to trigger presets instantly</div>
    </section>

    <!-- Cue Stack Section -->
    <section id="cueStackSection">
      <h2>üé¨ Cue Stack <span style="opacity: 0.6; font-size: 14px; font-weight: 400;">‚Äî Sequential Show Control</span></h2>
      <div class="cuestack-container">
        <div class="cuestack-header">
          <div class="cuestack-title">
            <span id="cueStackName" style="font-weight: 600;">My Show</span>
            <span id="cueStackStatus" class="cuestack-status">Ready</span>
          </div>
          <div class="cuestack-controls">
            <button id="manageCuesBtn" class="cuestack-btn" title="Manage Cues">‚öôÔ∏è Manage</button>
            <button id="resetCueStackBtn" class="cuestack-btn danger" title="Reset to Beginning">‚Ü∫ Reset</button>
          </div>
        </div>
        
        <div id="cueStackList" class="cuestack-list">
          <!-- Cues will be dynamically inserted here -->
        </div>
        
        <div class="cuestack-footer">
          <div class="cuestack-progress">
            <div class="cuestack-progress-label">
              <span id="cueProgressText">Cue 0 of 0</span>
            </div>
            <div class="cuestack-progress-bar">
              <div id="cueProgressFill" class="cuestack-progress-fill" style="width: 0%"></div>
            </div>
          </div>
          <button id="executeNextCueBtn" class="cuestack-btn primary" title="Execute Next Cue (Space)">
            ‚ñ∂ GO
          </button>
        </div>
        
        <div class="cuestack-hint">
          üí° Tip: Press <kbd>Space</kbd> to GO, <kbd>R</kbd> to reset, or <kbd>1</kbd>-<kbd>9</kbd>/<kbd>0</kbd> to fire specific cues
        </div>
      </div>
    </section>

    <section class="preview-section">
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">NDI Preview</h2>
      
      <iframe src="/video-test.html" width="100%" height="600" style="border: 1px solid #333; border-radius: 8px;"></iframe>
      
    </section>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="resolumeHost">Resolume IP Address:</label>
          <input type="text" id="resolumeHost" placeholder="10.1.110.72">
          <small>The IP address where Resolume Arena is running</small>
        </div>
        <div class="setting-group">
          <label for="resolumeRestPort">REST API Port:</label>
          <input type="number" id="resolumeRestPort" placeholder="8080" min="1" max="65535">
          <small>Port for Resolume's REST API (usually 8080)</small>
        </div>
        <div class="setting-group">
          <label for="resolumeOscPort">OSC Control Port:</label>
          <input type="number" id="resolumeOscPort" placeholder="7000" min="1" max="65535">
          <small>Port for OSC commands to Resolume (usually 7000)</small>
        </div>
        <div class="setting-group">
          <label for="serverPort">ShowCall Server Port:</label>
          <input type="number" id="serverPort" placeholder="3200" min="1024" max="65535">
          <small>Local port for ShowCall web interface</small>
        </div>
        
        <h3 style="margin: 24px 0 12px; color: var(--accent); font-size: 16px;">NDI Preview (OBS Integration)</h3>
        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="ndiAutoReconnect"> Auto-check NDI-OBS status
          </label>
          <small>Automatically monitor NDI stream via OBS Studio</small>
        </div>
        <div style="margin-bottom: 16px;">
          <label for="ndiQuality">Stream Quality:</label>
          <select id="ndiQuality">
            <option value="high">High Quality (1080p)</option>
            <option value="medium" selected>Medium Quality (720p)</option>
            <option value="low">Low Quality (480p)</option>
          </select>
        </div>
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; font-size: 13px;">
          <strong>üìã Setup Instructions:</strong><br>
          1. Install OBS Studio with NDI plugin<br>
          2. Add NDI source in OBS (10.1.110.72:5960)<br>
          3. Enable OBS WebSocket in Tools ‚Üí WebSocket Server<br>
          4. ShowCall will automatically connect and stream via OBS
        </div>        <div class="setting-actions">
          <button id="saveSettings" class="btn-primary">Save & Restart</button>
          <button id="cancelSettings" class="btn-secondary">Cancel</button>
        </div>
        <div class="setting-note">
          <strong>Note:</strong> Settings will be saved and ShowCall will restart to apply changes.
        </div>
      </div>
    </div>
  </div>

  <!-- Presets Modal -->
  <div id="presetsModal" class="modal" style="display: none;">
    <div class="modal-content preset-editor-modal">
      <div class="modal-header">
        <h2>Manage Presets</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body preset-editor-body">
        <!-- Preset List View -->
        <div id="presetListView" class="preset-list-view">
          <div class="preset-list-header">
            <h3>Your Presets</h3>
            <button id="addPresetBtn" class="btn-primary">+ Add New Preset</button>
          </div>
          <div id="presetList" class="preset-list"></div>
        </div>

        <!-- Preset Edit View -->
        <div id="presetEditView" class="preset-edit-view" style="display: none;">
          <div class="preset-edit-header">
            <button id="backToListBtn" class="btn-secondary">‚Üê Back to List</button>
            <h3 id="editPresetTitle">Edit Preset</h3>
          </div>
          
          <div class="preset-edit-form">
            <div class="form-group">
              <label for="presetId">Preset ID *</label>
              <input type="text" id="presetId" placeholder="e.g., walkin, sermon" required>
              <small>Unique identifier (lowercase, no spaces)</small>
            </div>

            <div class="form-group">
              <label for="presetLabel">Display Name *</label>
              <input type="text" id="presetLabel" placeholder="e.g., Walk-In Scene" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="presetHotkey">Hotkey</label>
                <input type="text" id="presetHotkey" placeholder="e.g., 1, B" maxlength="1">
                <small>Single key shortcut</small>
              </div>

              <div class="form-group">
                <label for="presetColor">Button Color</label>
                <input type="color" id="presetColor" value="#0ea5e9">
              </div>
            </div>

            <div class="form-group">
              <label>Macro Steps</label>
              <div id="macroSteps" class="macro-steps"></div>
              <div class="macro-add-controls">
                <select id="stepTypeSelect" class="step-type-select">
                  <option value="">-- Add Step --</option>
                  <option value="trigger">Trigger Clip</option>
                  <option value="triggerColumn">Trigger Column</option>
                  <option value="cut">Cut to Program</option>
                  <option value="clear">Clear All</option>
                  <option value="sleep">Sleep/Wait</option>
                </select>
              </div>
            </div>

            <div class="preset-edit-actions">
              <button id="savePresetBtn" class="btn-primary">Save Preset</button>
              <button id="deletePresetBtn" class="btn-danger" style="display: none;">Delete Preset</button>
              <button id="cancelEditBtn" class="btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Update Modal -->
  <div id="updateModal" class="modal" style="display: none;">
    <div class="modal-content update-modal">
      <div class="modal-header">
        <h2 id="updateModalTitle">Update Available</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="updateContent">
          <!-- Update Available View -->
          <div id="updateAvailableView" class="update-view" style="display: none;">
            <div class="update-icon">üì¶</div>
            <h3>ShowCall <span id="updateVersion"></span> is available!</h3>
            <p class="update-current">You're currently running version <span id="currentVersion"></span></p>
            
            <div class="update-info">
              <div class="update-info-item">
                <span class="label">Release Date:</span>
                <span id="updateReleaseDate">‚Äî</span>
              </div>
              <div class="update-info-item">
                <span class="label">Download Size:</span>
                <span id="updateSize">‚Äî</span>
              </div>
            </div>
            
            <div class="update-notes" id="updateNotes" style="display: none;">
              <h4>What's New:</h4>
              <div id="updateNotesContent"></div>
            </div>
            
            <div class="update-actions">
              <button id="downloadUpdateBtn" class="btn-primary">Download Update</button>
              <button id="viewReleaseNotesBtn" class="btn-secondary">View Full Release Notes</button>
              <button id="remindLaterBtn" class="btn-secondary">Remind Me Later</button>
            </div>
          </div>
          
          <!-- Downloading View -->
          <div id="updateDownloadingView" class="update-view" style="display: none;">
            <div class="update-icon">‚¨áÔ∏è</div>
            <h3>Downloading Update...</h3>
            <div class="progress-container">
              <div class="progress-bar">
                <div id="downloadProgressBar" class="progress-fill"></div>
              </div>
              <div class="progress-text">
                <span id="downloadPercent">0%</span>
                <span id="downloadSpeed">‚Äî</span>
              </div>
              <div class="progress-details">
                <span id="downloadTransferred">0 MB</span> of <span id="downloadTotal">0 MB</span>
              </div>
            </div>
            <p class="update-note">Please keep ShowCall running while the update downloads...</p>
          </div>
          
          <!-- Ready to Install View -->
          <div id="updateReadyView" class="update-view" style="display: none;">
            <div class="update-icon">‚úÖ</div>
            <h3>Update Ready to Install!</h3>
            <p>ShowCall <span id="readyVersion"></span> has been downloaded and is ready to install.</p>
            <p class="update-note">The app will restart to complete the installation.</p>
            <div class="update-actions">
              <button id="installNowBtn" class="btn-primary">Restart & Install Now</button>
              <button id="installLaterBtn" class="btn-secondary">Install on Next Launch</button>
            </div>
          </div>
          
          <!-- Checking View -->
          <div id="updateCheckingView" class="update-view" style="display: none;">
            <div class="update-icon spinner">üîÑ</div>
            <h3>Checking for Updates...</h3>
            <p>Please wait while we check for the latest version...</p>
          </div>
          
          <!-- No Update View -->
          <div id="updateNotAvailableView" class="update-view" style="display: none;">
            <div class="update-icon">‚úì</div>
            <h3>You're Up to Date!</h3>
            <p>ShowCall <span id="noUpdateVersion"></span> is the latest version.</p>
            <div class="update-actions">
              <button id="closeNoUpdateBtn" class="btn-primary">OK</button>
            </div>
          </div>
          
          <!-- Error View -->
          <div id="updateErrorView" class="update-view" style="display: none;">
            <div class="update-icon">‚ö†Ô∏è</div>
            <h3>Update Check Failed</h3>
            <p id="updateErrorMessage">Unable to check for updates. Please try again later.</p>
            <details class="error-details">
              <summary>Error Details</summary>
              <pre id="updateErrorStack"></pre>
            </details>
            <div class="update-actions">
              <button id="retryUpdateBtn" class="btn-primary">Retry</button>
              <button id="closeErrorBtn" class="btn-secondary">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cue Stack Management Modal -->
  <div id="cueStackModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 id="cueStackModalTitle">Manage Cue Stack</h2>
        <span class="close" id="closeCueStackModal">&times;</span>
      </div>
      <div class="modal-body">
        <!-- Cue Stack Name -->
        <div class="setting-group">
          <label for="cueStackNameInput">Cue Stack Name:</label>
          <input type="text" id="cueStackNameInput" placeholder="e.g., Sunday Service, Concert Show">
        </div>
        
        <!-- Available Presets -->
        <div class="setting-group">
          <label>Available Presets:</label>
          <div id="availablePresetsList" style="max-height: 200px; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px;">
            <!-- Presets will be listed here -->
          </div>
          <button id="addCustomCueBtn" style="width: 100%; margin-top: 12px; background: rgba(251, 191, 36, 0.15); border: 1px solid rgba(251, 191, 36, 0.3); color: rgb(251, 191, 36); padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s ease;">
            <span style="font-size: 16px;">‚ö°</span>
            <span>+ Add Custom Cue</span>
          </button>
        </div>
        
        <!-- Current Cue Stack -->
        <div class="setting-group">
          <label>Cue Stack Order: <span style="opacity: 0.6; font-size: 12px;">(Drag to reorder)</span></label>
          <div id="cueStackBuilderList" style="min-height: 150px; border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; background: rgba(255,255,255,0.02);">
            <!-- Cues in the stack will appear here -->
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; justify-content: space-between; gap: 12px;">
        <button id="clearCueStackBtn" class="btn-secondary" style="background: rgba(239, 68, 68, 0.2); border-color: rgba(239, 68, 68, 0.3); color: var(--red);">
          üóëÔ∏è Clear Stack
        </button>
        <div style="display: flex; gap: 12px;">
          <button id="cancelCueStackBtn" class="btn-secondary">Cancel</button>
          <button id="saveCueStackBtn" class="btn-primary">üíæ Save Cue Stack</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Custom Cue Builder Modal -->
  <div id="customCueModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>‚ö° Create Custom Cue</h2>
        <button id="closeCustomCueModal" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label>Cue Label:</label>
          <input type="text" id="customCueLabel" placeholder="e.g., House Lights On, Fog Machine, Special Effect">
        </div>
        
        <div class="setting-group">
          <label>Color:</label>
          <input type="color" id="customCueColor" value="#7dd3fc" style="width: 100%; height: 40px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer;">
        </div>
        
        <div class="setting-group">
          <label>Actions: <span style="opacity: 0.6; font-size: 12px;">(Steps to execute in sequence)</span></label>
          <div id="customCueActionsList" style="border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; background: rgba(255,255,255,0.02); min-height: 100px; max-height: 400px; overflow-y: auto;">
            <!-- Actions will appear here -->
          </div>
          <button id="addActionBtn" style="width: 100%; margin-top: 8px; background: rgba(125, 211, 252, 0.15); border: 1px solid rgba(125, 211, 252, 0.3); color: var(--accent-light); padding: 8px; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">
            + Add Action
          </button>
        </div>
        
        <div class="setting-group" style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 8px; padding: 12px;">
          <div style="font-size: 12px; color: rgba(251, 191, 36, 0.9); margin-bottom: 8px;">
            <strong>üí° Tip:</strong>
          </div>
          <div style="font-size: 11px; line-height: 1.6; color: rgba(255,255,255,0.7);">
            Build actions just like presets! Choose from Trigger Clip, Trigger Column, Clear, Cut, or add delays between steps.
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px;">
        <button id="cancelCustomCueBtn" class="btn-secondary">Cancel</button>
        <button id="saveCustomCueBtn" class="btn-primary">Save Custom Cue</button>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>


