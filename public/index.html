<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShowCall ‚Äî Resolume Arena Controller</title>
  <meta name="description" content="Professional Resolume Arena 7.19 controller for live events">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="page">
    <header class="top">
      <h1>ShowCall <span style="opacity: 0.5; font-weight: 400; font-size: 14px;">via OSC</span></h1>
      <div class="meta">
        <span id="comp" style="font-weight: 600;">‚Äî</span>
        <span id="bpm">BPM: ‚Äî</span>
  <span id="version" class="version-display" title="ShowCall Version">v2.3.2</span>
        <div id="updateIndicator" class="update-indicator" style="display: none;" title="Update available">
          <span class="update-icon">üì¶</span>
          <span class="update-text">Update Available</span>
        </div>
        <button id="deckWindowBtn" class="settings-btn" title="Pop-out Preset Deck">ü™ü Pop-out Deck</button>
        <button id="checkUpdateBtn" class="settings-btn" title="Check for Updates" style="display: none;">üîÑ Check Updates</button>
        <button id="settingsBtn" class="settings-btn" title="Settings">‚öôÔ∏è Settings</button>
        <button id="presetsBtn" class="settings-btn" title="Manage Presets">üéõÔ∏è Presets</button>
      </div>
    </header>

    <section class="status-bar unified-status">
      <div class="tile prog-tile" id="programTile" title="Active Program Clip">
        <div class="title program">PROGRAM</div>
        <div class="clip" id="progName">‚Äî</div>
        <div class="sub" id="progLayer">Layer ‚Äî ‚Ä¢ Col ‚Äî</div>
      </div>
      <div class="tile prev-tile" id="previewTile" title="Active Preview Clip">
        <div class="title preview">PREVIEW</div>
        <div class="clip" id="prevName">‚Äî</div>
        <div class="sub" id="prevLayer">Layer ‚Äî ‚Ä¢ Col ‚Äî</div>
      </div>
    </section>

    <section id="grid" role="grid" aria-label="Resolume clip grid"></section>

    <section class="actions">
      <h3 style="margin: 16px 0 8px; opacity: 0.9; font-size: 14px; font-weight: 600;">Quick Actions</h3>
      <div id="quickCues" class="cues" role="toolbar" aria-label="Quick action buttons"></div>
    </section>

    <section>
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">Preset Deck</h2>
      <div id="deck" class="deck" role="toolbar" aria-label="Preset buttons"></div>
      <div class="hint">üí° Use keyboard shortcuts (1, 2, B, etc.) to trigger presets instantly</div>
    </section>

    <section class="preview-section">
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">NDI Preview</h2>
      
      <iframe src="/video-test.html" width="100%" height="600" style="border: 1px solid #333; border-radius: 8px;"></iframe>
      
    </section>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="resolumeHost">Resolume IP Address:</label>
          <input type="text" id="resolumeHost" placeholder="10.1.110.72">
          <small>The IP address where Resolume Arena is running</small>
        </div>
        <div class="setting-group">
          <label for="resolumeRestPort">REST API Port:</label>
          <input type="number" id="resolumeRestPort" placeholder="8080" min="1" max="65535">
          <small>Port for Resolume's REST API (usually 8080)</small>
        </div>
        <div class="setting-group">
          <label for="resolumeOscPort">OSC Control Port:</label>
          <input type="number" id="resolumeOscPort" placeholder="7000" min="1" max="65535">
          <small>Port for OSC commands to Resolume (usually 7000)</small>
        </div>
        <div class="setting-group">
          <label for="serverPort">ShowCall Server Port:</label>
          <input type="number" id="serverPort" placeholder="3200" min="1024" max="65535">
          <small>Local port for ShowCall web interface</small>
        </div>
        
        <h3 style="margin: 24px 0 12px; color: var(--accent); font-size: 16px;">NDI Preview (OBS Integration)</h3>
        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="ndiAutoReconnect"> Auto-check NDI-OBS status
          </label>
          <small>Automatically monitor NDI stream via OBS Studio</small>
        </div>
        <div style="margin-bottom: 16px;">
          <label for="ndiQuality">Stream Quality:</label>
          <select id="ndiQuality">
            <option value="high">High Quality (1080p)</option>
            <option value="medium" selected>Medium Quality (720p)</option>
            <option value="low">Low Quality (480p)</option>
          </select>
        </div>
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; font-size: 13px;">
          <strong>üìã Setup Instructions:</strong><br>
          1. Install OBS Studio with NDI plugin<br>
          2. Add NDI source in OBS (10.1.110.72:5960)<br>
          3. Enable OBS WebSocket in Tools ‚Üí WebSocket Server<br>
          4. ShowCall will automatically connect and stream via OBS
        </div>        <div class="setting-actions">
          <button id="saveSettings" class="btn-primary">Save & Restart</button>
          <button id="cancelSettings" class="btn-secondary">Cancel</button>
        </div>
        <div class="setting-note">
          <strong>Note:</strong> Settings will be saved and ShowCall will restart to apply changes.
        </div>
      </div>
    </div>
  </div>

  <!-- Presets Modal -->
  <div id="presetsModal" class="modal" style="display: none;">
    <div class="modal-content preset-editor-modal">
      <div class="modal-header">
        <h2>Manage Presets</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body preset-editor-body">
        <!-- Preset List View -->
        <div id="presetListView" class="preset-list-view">
          <div class="preset-list-header">
            <h3>Your Presets</h3>
            <button id="addPresetBtn" class="btn-primary">+ Add New Preset</button>
          </div>
          <div id="presetList" class="preset-list"></div>
        </div>

        <!-- Preset Edit View -->
        <div id="presetEditView" class="preset-edit-view" style="display: none;">
          <div class="preset-edit-header">
            <button id="backToListBtn" class="btn-secondary">‚Üê Back to List</button>
            <h3 id="editPresetTitle">Edit Preset</h3>
          </div>
          
          <div class="preset-edit-form">
            <div class="form-group">
              <label for="presetId">Preset ID *</label>
              <input type="text" id="presetId" placeholder="e.g., walkin, sermon" required>
              <small>Unique identifier (lowercase, no spaces)</small>
            </div>

            <div class="form-group">
              <label for="presetLabel">Display Name *</label>
              <input type="text" id="presetLabel" placeholder="e.g., Walk-In Scene" required>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="presetHotkey">Hotkey</label>
                <input type="text" id="presetHotkey" placeholder="e.g., 1, B" maxlength="1">
                <small>Single key shortcut</small>
              </div>

              <div class="form-group">
                <label for="presetColor">Button Color</label>
                <input type="color" id="presetColor" value="#0ea5e9">
              </div>
            </div>

            <div class="form-group">
              <label>Macro Steps</label>
              <div id="macroSteps" class="macro-steps"></div>
              <div class="macro-add-controls">
                <select id="stepTypeSelect" class="step-type-select">
                  <option value="">-- Add Step --</option>
                  <option value="trigger">Trigger Clip</option>
                  <option value="triggerColumn">Trigger Column</option>
                  <option value="cut">Cut to Program</option>
                  <option value="clear">Clear All</option>
                  <option value="sleep">Sleep/Wait</option>
                </select>
              </div>
            </div>

            <div class="preset-edit-actions">
              <button id="savePresetBtn" class="btn-primary">Save Preset</button>
              <button id="deletePresetBtn" class="btn-danger" style="display: none;">Delete Preset</button>
              <button id="cancelEditBtn" class="btn-secondary">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Update Modal -->
  <div id="updateModal" class="modal" style="display: none;">
    <div class="modal-content update-modal">
      <div class="modal-header">
        <h2 id="updateModalTitle">Update Available</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div id="updateContent">
          <!-- Update Available View -->
          <div id="updateAvailableView" class="update-view" style="display: none;">
            <div class="update-icon">üì¶</div>
            <h3>ShowCall <span id="updateVersion"></span> is available!</h3>
            <p class="update-current">You're currently running version <span id="currentVersion"></span></p>
            
            <div class="update-info">
              <div class="update-info-item">
                <span class="label">Release Date:</span>
                <span id="updateReleaseDate">‚Äî</span>
              </div>
              <div class="update-info-item">
                <span class="label">Download Size:</span>
                <span id="updateSize">‚Äî</span>
              </div>
            </div>
            
            <div class="update-notes" id="updateNotes" style="display: none;">
              <h4>What's New:</h4>
              <div id="updateNotesContent"></div>
            </div>
            
            <div class="update-actions">
              <button id="downloadUpdateBtn" class="btn-primary">Download Update</button>
              <button id="viewReleaseNotesBtn" class="btn-secondary">View Full Release Notes</button>
              <button id="remindLaterBtn" class="btn-secondary">Remind Me Later</button>
            </div>
          </div>
          
          <!-- Downloading View -->
          <div id="updateDownloadingView" class="update-view" style="display: none;">
            <div class="update-icon">‚¨áÔ∏è</div>
            <h3>Downloading Update...</h3>
            <div class="progress-container">
              <div class="progress-bar">
                <div id="downloadProgressBar" class="progress-fill"></div>
              </div>
              <div class="progress-text">
                <span id="downloadPercent">0%</span>
                <span id="downloadSpeed">‚Äî</span>
              </div>
              <div class="progress-details">
                <span id="downloadTransferred">0 MB</span> of <span id="downloadTotal">0 MB</span>
              </div>
            </div>
            <p class="update-note">Please keep ShowCall running while the update downloads...</p>
          </div>
          
          <!-- Ready to Install View -->
          <div id="updateReadyView" class="update-view" style="display: none;">
            <div class="update-icon">‚úÖ</div>
            <h3>Update Ready to Install!</h3>
            <p>ShowCall <span id="readyVersion"></span> has been downloaded and is ready to install.</p>
            <p class="update-note">The app will restart to complete the installation.</p>
            <div class="update-actions">
              <button id="installNowBtn" class="btn-primary">Restart & Install Now</button>
              <button id="installLaterBtn" class="btn-secondary">Install on Next Launch</button>
            </div>
          </div>
          
          <!-- Checking View -->
          <div id="updateCheckingView" class="update-view" style="display: none;">
            <div class="update-icon spinner">üîÑ</div>
            <h3>Checking for Updates...</h3>
            <p>Please wait while we check for the latest version...</p>
          </div>
          
          <!-- No Update View -->
          <div id="updateNotAvailableView" class="update-view" style="display: none;">
            <div class="update-icon">‚úì</div>
            <h3>You're Up to Date!</h3>
            <p>ShowCall <span id="noUpdateVersion"></span> is the latest version.</p>
            <div class="update-actions">
              <button id="closeNoUpdateBtn" class="btn-primary">OK</button>
            </div>
          </div>
          
          <!-- Error View -->
          <div id="updateErrorView" class="update-view" style="display: none;">
            <div class="update-icon">‚ö†Ô∏è</div>
            <h3>Update Check Failed</h3>
            <p id="updateErrorMessage">Unable to check for updates. Please try again later.</p>
            <details class="error-details">
              <summary>Error Details</summary>
              <pre id="updateErrorStack"></pre>
            </details>
            <div class="update-actions">
              <button id="retryUpdateBtn" class="btn-primary">Retry</button>
              <button id="closeErrorBtn" class="btn-secondary">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>

