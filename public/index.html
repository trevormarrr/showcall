<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShowCall — Resolume Arena Controller</title>
  <meta name="description" content="Professional Resolume Arena 7.19 controller for live events">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="page">
    <header class="top">
      <h1>ShowCall <span style="opacity: 0.5; font-weight: 400; font-size: 14px;">via OSC</span></h1>
      <div class="meta">
        <span id="comp" style="font-weight: 600;">—</span>
        <span id="bpm">BPM: —</span>
        <span id="version" class="version-display" title="ShowCall Version">v1.4.0</span>
        <div id="updateIndicator" class="update-indicator" style="display: none;" title="Update available">
          <span class="update-icon">📦</span>
          <span class="update-text">Update Available</span>
        </div>
        <button id="deckWindowBtn" class="settings-btn" title="Pop-out Preset Deck">🪟 Pop-out Deck</button>
        <button id="checkUpdateBtn" class="settings-btn" title="Check for Updates" style="display: none;">🔄 Check Updates</button>
        <button id="settingsBtn" class="settings-btn" title="Settings">⚙️ Settings</button>
        <button id="presetsBtn" class="settings-btn" title="Manage Presets">🎛️ Presets</button>
      </div>
    </header>

    <section class="status-bar unified-status">
      <div class="tile prog-tile" id="programTile" title="Active Program Clip">
        <div class="title program">PROGRAM</div>
        <div class="clip" id="progName">—</div>
        <div class="sub" id="progLayer">Layer — • Col —</div>
      </div>
      <div class="tile prev-tile" id="previewTile" title="Active Preview Clip">
        <div class="title preview">PREVIEW</div>
        <div class="clip" id="prevName">—</div>
        <div class="sub" id="prevLayer">Layer — • Col —</div>
      </div>
    </section>

    <section id="grid" role="grid" aria-label="Resolume clip grid"></section>

    <section class="actions">
      <h3 style="margin: 16px 0 8px; opacity: 0.9; font-size: 14px; font-weight: 600;">Quick Actions</h3>
      <div id="quickCues" class="cues" role="toolbar" aria-label="Quick action buttons"></div>
    </section>

    <section>
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">Preset Deck</h2>
      <div id="deck" class="deck" role="toolbar" aria-label="Preset buttons"></div>
      <div class="hint">💡 Use keyboard shortcuts (1, 2, B, etc.) to trigger presets instantly</div>
    </section>

    <section class="preview-section">
      <h2 style="margin: 24px 0 8px; opacity: 0.9; font-size: 18px; font-weight: 600;">NDI Preview</h2>
      
      <iframe src="/video-test.html" width="100%" height="600" style="border: 1px solid #333; border-radius: 8px;"></iframe>
      
    </section>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="resolumeHost">Resolume IP Address:</label>
          <input type="text" id="resolumeHost" placeholder="10.1.110.72">
          <small>The IP address where Resolume Arena is running</small>
        </div>
        <div class="setting-group">
          <label for="resolumeRestPort">REST API Port:</label>
          <input type="number" id="resolumeRestPort" placeholder="8080" min="1" max="65535">
          <small>Port for Resolume's REST API (usually 8080)</small>
        </div>
        <div class="setting-group">
          <label for="resolumeOscPort">OSC Control Port:</label>
          <input type="number" id="resolumeOscPort" placeholder="7000" min="1" max="65535">
          <small>Port for OSC commands to Resolume (usually 7000)</small>
        </div>
        <div class="setting-group">
          <label for="serverPort">ShowCall Server Port:</label>
          <input type="number" id="serverPort" placeholder="3200" min="1024" max="65535">
          <small>Local port for ShowCall web interface</small>
        </div>
        
        <h3 style="margin: 24px 0 12px; color: var(--accent); font-size: 16px;">NDI Preview (OBS Integration)</h3>
        <div style="margin-bottom: 16px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="ndiAutoReconnect"> Auto-check NDI-OBS status
          </label>
          <small>Automatically monitor NDI stream via OBS Studio</small>
        </div>
        <div style="margin-bottom: 16px;">
          <label for="ndiQuality">Stream Quality:</label>
          <select id="ndiQuality">
            <option value="high">High Quality (1080p)</option>
            <option value="medium" selected>Medium Quality (720p)</option>
            <option value="low">Low Quality (480p)</option>
          </select>
        </div>
        <div style="margin-bottom: 16px; padding: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; font-size: 13px;">
          <strong>📋 Setup Instructions:</strong><br>
          1. Install OBS Studio with NDI plugin<br>
          2. Add NDI source in OBS (10.1.110.72:5960)<br>
          3. Enable OBS WebSocket in Tools → WebSocket Server<br>
          4. ShowCall will automatically connect and stream via OBS
        </div>        <div class="setting-actions">
          <button id="saveSettings" class="btn-primary">Save & Restart</button>
          <button id="cancelSettings" class="btn-secondary">Cancel</button>
        </div>
        <div class="setting-note">
          <strong>Note:</strong> Settings will be saved and ShowCall will restart to apply changes.
        </div>
      </div>
    </div>
  </div>

  <!-- Presets Modal -->
  <div id="presetsModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Manage Presets</h2>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body">
        <div class="setting-group">
          <label for="presetsEditor">Presets JSON</label>
          <textarea id="presetsEditor" style="width:100%; height: 300px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 12px; background: rgba(255,255,255,0.05); color: var(--text); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; padding: 10px;"></textarea>
          <small>Tip: Each preset supports: id, name, hotkey, color, macro (array of steps). Step types: trigger {layer,column}, triggerColumn {column}, cut, clear, sleep {ms}.</small>
        </div>
        <div class="setting-actions">
          <button id="savePresets" class="btn-primary">Save Presets</button>
          <button id="cancelPresets" class="btn-secondary">Cancel</button>
        </div>
        <div class="setting-note">
          <strong>Note:</strong> Invalid JSON will be rejected. After saving, your deck and hotkeys will update immediately.
        </div>
      </div>
    </div>
  </div>

  <script src="/app.js"></script>
</body>
</html>
